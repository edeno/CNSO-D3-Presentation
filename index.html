<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<style>

@import url(http://fonts.googleapis.com/css?family=PT+Serif|PT+Serif:b|PT+Serif:i);

section {
  background: #000;
  color: #fff;
  padding: 2em;
  font-family: "PT Serif", Baskerville, Georgia;
}

#follow {
  background: none;
}

.grey {
  color: #777;
}

a:link,
a:visited {
  color: orange;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

.bar rect {
  fill: steelblue;
  shape-rendering: crispEdges;
  stroke: #fff;
}

path, line {
  fill: none;
  stroke: #fff;
  shape-rendering: crispEdges;
}
text {
  fill: #fff;
  font-size: 10px;
}

</style>

<section style="text-align:center;padding-top:5em;">
  <p style="font-size:120%;"> <b>Statistics, Visualizations, and D3</b>
    <br>
    <br> by Eric Denovellis
</section>

<section id="histogram" style="padding:5em 9em;">
  <p>statistics are a way of summarizing data
    <figure id="histVis">
    </figure>
</section>

<section style="padding:5em 9em;">
  <p>that acknowledges:
     <ul>
      <li>Uncertainty</li>
      <li>Variability</li>
      <li>Assumptions</li>
      <li>Complexity</li>
    </ul>
</section>

<section style="padding:5em 9em;">
  <p>statistics is summary with transparency (ideally)

</section>

<section id="effectiveVis" style="padding:5em 9em;">
  <p>visualizations are the most effective way to display data summaries
    <figure id="pathVis"> </figure>
</section>

<section style="padding:5em 9em;">
  <p>Problems with current static figures
  <figure> </figure>
</section>

<section style="padding:5em 9em;">
  <p>Examples of dynamic figures
    <br><a href="http://mbtaviz.github.io/">Visualizing MBTA Data</a>
    <br><a href="http://hockeyimpact.darkhorseanalytics.com/?m=Pay&t=Stanley%20Cup%20Champion&ht=&hy=">Payroll effect on hockey performance</a>
    <br><a href="http://www.nytimes.com/interactive/2014/07/08/upshot/how-the-year-you-were-born-influences-your-politics.html?abt=0002&abg=0">How the year you were born influences political views</a>
</section>

<section style="padding:5em 9em;">
  <p>What is d3?
  <br> D3 is a low level javascript based library for turning data into web elements
</section>

<section style="padding:5em 9em;">
  <p>Your browser requests and receives a html document from a server
</section>
<section style="padding:5em 9em;">
  <p>Your browser interprets the html and builds a document object model (DOM)
</section>
<section style="padding:5em 9em;">
  <p>Your browser interprets the html and builds a document object model (DOM)
    <ul>
     <li>html is the set of instructions to build a DOM</li>
     <li>the DOM is how the server understands the instructions (and subsequently displays it)</li>
   </ul>
</section>
<section style="padding:5em 9em;">
  <p>The DOM is represented as a tree data structure
    <ul>
     <li>nodes are objects with properties corresponding to html elements </li>
     <li>hierarchy is based on the html encapsulation</li>
   </ul>
</section>

<section style="padding:5em 9em;">
  <p>You use javascript to manipulate the DOM
  <br>D3 gives you tools to make this easier
</section>

<section style="padding:5em 9em;">
  <p>Data joins, exits, enters
  <br>data is stored as a property of a node:
  <br> if dataset changes, d3 can handle those changes easily by allowing you to decide what to do with
  <ul>
   <li>new data not bound to a node</li>
   <li>existing data bound to a node</li>
   <li>data that no longer exists bound to a node</li>
 </ul>
</section>

<section style="padding:5em 9em;">
  <p>Data joins, exits, enters Examples
  <figure> </figure>
</section>

<section style="font-size:80%;padding:5em 9em;">
  <p>D3 pros and cons
  <ul> Pros
   <li>Web based - easy to share</li>
   <li>Flexible styling - web design constantly evolving </li>
   <li>Easy to save static figures - SVG</li>
  </ul>
  <ul> Cons
   <li>Learning Curve</li>
   <li>Takes more time</li>
   <li>Additional complexity</li>
  </ul>
</section>

<section style="padding:5em 9em;">
  <p>What do I need to get started?
  <br>resources
		* html, css, svg
		* javascript
		* web console
		* text editor
		* local server
		* talks
</section>



<script src="d3.v3.min.js"></script>
<script src="stack.v1.min.js"></script>
<script>

var mystack = stack()
    .on("activate", activate)
    .on("deactivate", deactivate);

var section = d3.selectAll("section"),
    hist = d3.select("#histogram"),
    histIndex = section[0].indexOf(hist.node());
    eff = d3.select("#effectiveVis"),
    pathIndex = section[0].indexOf(eff.node());

var histInterval;

function activate(d, i) {
  if (i === histIndex) {
    startHist();
    histInterval = setInterval(function() {
              startHist();
      }, 3000);
    };
  if (i === pathIndex) {
    startPath();
  }
}

function deactivate(d, i) {
  if (i === histIndex) stopHist();
}

// Histogram

function startHist() {
  var n = 50,
      randomFunc = d3.random.normal(5, 3),
      dataset = d3.range(n).map(randomFunc),
      histFig = hist.select("#histVis");

  var margin = {top: 10, right: 30, bottom: 30, left: 30},
      width = 400 - margin.left - margin.right,
      height = 200 - margin.top - margin.bottom;

  var xScale = d3.scale.linear()
            .domain([-15,25])
            .range([0, width]);

  var binned = d3.layout.histogram()
        .bins(xScale.ticks(40))
        (dataset);

  var histMean = d3.mean(dataset);
  var yScale = d3.scale.linear()
            .domain([0, d3.max(binned, function(d) { return d.y; })])
            .range([height, 0]);

  var xAxis = d3.svg.axis()
                .scale(xScale)
                .orient("bottom");

  var svg = histFig.selectAll("svg").data([{}]);
      svg.enter()
              .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);

  var svgG = svg.selectAll("g#drawingArea").data([{}]);
      svgG.enter()
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
          .attr("id", "drawingArea");

  var bar = svgG.selectAll("g.bar")
                .data(binned);
      bar.exit()
        .remove();
      bar.enter()
        .append("g")
            .attr("class", "bar");
      bar
        .attr("transform", function(d) {
          return "translate(" + xScale(d.x) + "," + 0 + ")";
        });

  var rect = bar.selectAll("rect")
                .data(function(d) {return [d];});
      rect.enter()
          .append("rect")
            .attr("x", 1);
  var rectSize = Math.abs(xScale(binned[0].x) - xScale(binned[0].x + binned[0].dx));
      rect
        .transition()
          .duration(1000)
        .attr("height", function(d) {
            return height - yScale(d.y);
        })
        .attr("y", function(d) {
            return yScale(d.y);
        })
        .attr("width", function(d) {
          return rectSize - 1;
        });
  var gAxis = svgG.selectAll("g.xAxis").data([{}]);
      gAxis.enter()
        .append("g")
          .attr("class", "xAxis")
          .attr("transform", "translate(0," + height + ")");
      gAxis
        .call(xAxis);

  var meanBar = svgG.selectAll("rect#Mean")
                    .data([histMean]);
      meanBar.enter()
        .append("rect")
          .attr("id", "Mean")
          .attr("height", height)
          .attr("y", 0)
          .attr("fill", "red")
          .attr("opacity", .6);
     meanBar
       .transition()
         .duration(500)
       .attr("x", function(d) {return xScale(d);})
       .attr("width", rectSize/2);

}

function stopHist() {
  histInterval = clearInterval(histInterval);
}


function startPath() {
  var n = 40,
      randomFunc = d3.random.normal(0, .4),
      data = d3.range(n).map(randomFunc),
      pathFig = eff.select("#pathVis");
  var margin = {top: 20, right: 20, bottom: 20, left: 40},
      width = 800 - margin.left - margin.right,
      height = 200 - margin.top - margin.bottom;
  var xScale = d3.scale.linear()
            .domain([0, n - 1])
            .range([0, width]);
  var yScale = d3.scale.linear()
            .domain([-1, 1])
            .range([height, 0]);
  var line = d3.svg.line()
            .interpolate("basis")
            .x(function(d, i) { return xScale(i); })
            .y(function(d, i) { return yScale(d); });
  var svg = pathFig.selectAll("svg").data([{}]);
      svg.enter()
              .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);

  var svgG = svg.selectAll("g#drawingArea").data([{}]).enter()
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
          .attr("id", "drawingArea");

  var defs = svgG.selectAll("defs").data([{}]).enter()
          .append("defs")
            .append("clipPath")
              .attr("id", "clip")
            .append("rect")
              .attr("width", width)
              .attr("height", height);

  var xAxis = d3.svg.axis()
                  .scale(xScale)
                  .ticks(0)
                  .orient("bottom");
  var xAxisG = svgG.selectAll("g.xAxis").data([{}]);
  xAxisG.enter()
      .append("g")
        .attr("class", "xAxis")
        .attr("transform", "translate(0," + yScale(0) + ")");
  xAxisG
    .call(xAxis);
  var yAxis = svgG.selectAll("g.yAxis").data([{}]);
  yAxis.enter()
    .append("g")
      .attr("class", "yAxis");
  yAxis
    .call(d3.svg.axis().scale(yScale).ticks(3).orient("left"));
  var clip = svgG.selectAll("g#clip").data([{}]);
      clip.enter()
        .append("g")
        .attr("id", "clip")
        .attr("clip-path", "url(#clip)");

  var path = clip.selectAll("path.line")
              .data([data]);
  path.enter()
    .append("path")
    .attr("class", "line");
  path
    .attr("d", line);
  var format = d3.format(".1f");
  tick();

  function tick() {
    // push a new data point onto the back
    data.push(randomFunc());
    // redraw the line, and slide it to the left
    path
      .attr("d", line)
      .attr("transform", null)
    .transition()
      .duration(500)
      .ease("linear")
    .attr("transform", "translate(" + xScale(-1) + ",0)")
      .each("end", tick);
    var text = clip.selectAll("text.number")
          .data(data);
    text.exit()
        .remove();
    text.enter()
      .append("text")
      .attr("class", "number")
      .attr("y", height)
      .style("font-size", "9px");
    text
      .attr("x", function(d, i) {
        return xScale(i);
      })
      .text(function(d) {
        return format(d);
        });
    // pop the old data point off the front
    data.shift();
  }
}

function stopPath() {

}
</script>
